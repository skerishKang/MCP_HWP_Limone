# Claude Code를 위한 고급 한글 MCP 서버 개발 프롬프트

## 프로젝트 개요
한글(HWP)의 모든 기능을 제어할 수 있는 고도화된 MCP(Model Context Protocol) 서버를 Python으로 개발합니다. 기존 기본 한글 MCP의 제한적인 기능을 넘어서, 한글 COM API의 모든 기능을 활용하여 완전한 문서 제어를 제공합니다.

## 개발 환경 설정

### 필수 요구사항
- Python 3.10 이상
- Windows 환경 (한글 프로그램 설치 필요)
- uv 패키지 매니저 사용 권장

### 설치할 패키지
```bash
uv add mcp fastmcp pywin32 pythoncom
```

## 핵심 기술 스택
- **MCP Framework**: FastMCP (Anthropic의 공식 Python MCP SDK)
- **한글 제어**: pywin32의 win32com.client를 통한 COM 객체 활용
- **API**: HWPFrame.HwpObject (한글 COM API)

## 개발할 주요 기능

### 1. 기본 문서 제어
- `create_document()`: 새 문서 생성
- `open_document(path)`: 문서 열기
- `save_document(path)`: 문서 저장
- `close_document()`: 문서 닫기
- `get_document_info()`: 문서 정보 조회

### 2. 고급 텍스트 조작
- `insert_text_at_position(text, x, y)`: 좌표 기반 텍스트 삽입
- `insert_text_at_paragraph(text, paragraph_index)`: 문단 번호 기반 삽입
- `select_text_range(start_pos, end_pos)`: 정확한 텍스트 범위 선택
- `find_and_replace(find_text, replace_text, options)`: 고급 찾기/바꾸기
- `move_cursor_to_position(x, y)`: 커서 위치 이동

### 3. 완전한 서식 제어
- `apply_font_format(font_name, size, bold, italic, underline, color)`: 글꼴 서식
- `apply_paragraph_format(align, indent, line_spacing)`: 문단 서식  
- `set_text_color(r, g, b)`: 텍스트 색상 설정
- `set_background_color(r, g, b)`: 배경색 설정
- `apply_text_effects(shadow, outline, emboss)`: 텍스트 효과

### 4. 페이지 및 문서 레이아웃
- `set_page_size(width, height)`: 용지 크기 설정
- `set_page_margins(top, bottom, left, right)`: 여백 설정
- `set_page_orientation(landscape)`: 용지 방향 설정
- `insert_header_footer(text, is_header)`: 머리글/바닥글 삽입
- `insert_page_break()`: 페이지 나누기

### 5. 고급 표 기능
- `create_table_advanced(rows, cols, style_options)`: 고급 표 생성
- `merge_table_cells(start_row, start_col, end_row, end_col)`: 셀 병합
- `set_table_border_style(style, width, color)`: 표 테두리 스타일
- `auto_fit_table_content()`: 표 자동 크기 조정
- `insert_data_to_table(data, start_cell)`: 데이터 일괄 입력

### 6. 객체 삽입 및 관리
- `insert_image(path, x, y, width, height)`: 이미지 삽입 및 크기 조정
- `insert_shape(shape_type, x, y, width, height)`: 도형 삽입
- `insert_textbox(text, x, y, width, height)`: 텍스트 상자 삽입
- `insert_hyperlink(text, url)`: 하이퍼링크 삽입
- `create_bookmark(name, position)`: 책갈피 생성

### 7. 문서 구조 관리
- `create_table_of_contents()`: 목차 자동 생성
- `apply_heading_style(level, text)`: 제목 스타일 적용
- `insert_footnote(text)`: 각주 삽입
- `insert_endnote(text)`: 미주 삽입
- `set_document_protection(password, options)`: 문서 보호

### 8. 고급 기능
- `export_to_pdf(output_path, options)`: PDF 변환
- `print_document(printer_name, options)`: 인쇄 실행
- `run_macro(macro_name)`: 매크로 실행
- `get_text_statistics()`: 문서 통계 (글자 수, 페이지 수 등)

## 개발 구조 예시

```python
from mcp.server.fastmcp import FastMCP
import win32com.client
import pythoncom
import os
from typing import Optional, Dict, Any, List

# MCP 서버 초기화
mcp = FastMCP("Advanced HWP Server")

class AdvancedHwpController:
    def __init__(self):
        """한글 COM 객체 초기화"""
        try:
            pythoncom.CoInitialize()
            self.hwp = win32com.client.gencache.EnsureDispatch("HWPFrame.HwpObject")
            self.hwp.XHwpWindows.Item(0).Visible = True
        except Exception as e:
            raise Exception(f"한글 초기화 실패: {e}")
    
    def __del__(self):
        """리소스 정리"""
        try:
            pythoncom.CoUninitialize()
        except:
            pass

# 전역 컨트롤러 인스턴스
hwp_controller = AdvancedHwpController()

@mcp.tool()
def create_document() -> str:
    """새 한글 문서를 생성합니다."""
    try:
        hwp_controller.hwp.HAction.Run("FileNew")
        return "새 문서가 생성되었습니다."
    except Exception as e:
        return f"문서 생성 실패: {e}"

@mcp.tool()
def insert_text_at_position(text: str, x: int = 0, y: int = 0) -> str:
    """지정된 좌표에 텍스트를 삽입합니다."""
    try:
        # 좌표로 커서 이동
        hwp_controller.hwp.SetPos(x, y)
        
        # 텍스트 삽입
        act = hwp_controller.hwp.CreateAction("InsertText")
        pset = act.CreateSet()
        pset.SetItem("Text", text)
        act.Execute(pset)
        
        return f"위치 ({x}, {y})에 텍스트 '{text}'를 삽입했습니다."
    except Exception as e:
        return f"텍스트 삽입 실패: {e}"

# 더 많은 도구들을 여기에 추가...
```

## 개발 우선순위

### 1단계: 핵심 인프라 (Day 1)
1. MCP 서버 기본 구조 설정
2. 한글 COM 객체 연결 및 초기화
3. 기본 문서 생성/열기/저장 기능
4. 오류 처리 및 로깅 시스템

### 2단계: 텍스트 제어 (Day 2-3)
1. 정밀한 텍스트 위치 지정 기능
2. 텍스트 선택 및 범위 지정
3. 기본 서식 적용 (글꼴, 크기, 굵기, 기울임, 밑줄)
4. 찾기/바꾸기 고급 기능

### 3단계: 서식 및 레이아웃 (Day 4-5)
1. 문단 서식 (정렬, 들여쓰기, 줄간격)
2. 페이지 설정 (여백, 용지 크기, 방향)
3. 색상 및 텍스트 효과
4. 스타일 생성 및 적용

### 4단계: 객체 및 고급 기능 (Day 6-7)
1. 표 생성 및 고급 편집
2. 이미지 및 도형 삽입
3. 하이퍼링크 및 책갈피
4. PDF 변환 및 인쇄

## 중요한 개발 고려사항

### COM 객체 관리
- 메모리 누수 방지를 위한 적절한 객체 생명주기 관리
- 예외 상황에서의 안전한 리소스 해제
- 스레드 안전성 고려

### 오류 처리 전략
- 한글 프로그램 미설치 상황 대응
- COM 객체 초기화 실패 처리
- 잘못된 매개변수 검증
- 사용자 친화적 오류 메시지

### 성능 최적화
- 반복적인 COM 호출 최소화
- 배치 작업 지원
- 큰 문서 처리 시 진행률 표시

## 테스트 전략

### 단위 테스트
- 각 MCP 도구별 기능 테스트
- 다양한 매개변수 조합 테스트
- 오류 시나리오 테스트

### 통합 테스트
- Claude Desktop과의 연동 테스트
- 복잡한 문서 작업 시나리오 테스트
- 성능 및 안정성 테스트

## 배포 및 설치

### Claude Desktop 설정
```json
{
  "mcpServers": {
    "advanced-hwp": {
      "command": "uv",
      "args": [
        "--directory",
        "G:/Ddrive/BatangD/task/workdiary/33MCP_HWP",
        "run",
        "python",
        "advanced_hwp_server.py"
      ]
    }
  }
}
```

## 성공 기준
1. 기존 한글 MCP 대비 10배 이상 많은 기능 제공
2. 텍스트 위치 지정 정확도 100%
3. Claude와의 자연어 명령 성공률 95% 이상
4. 안정적인 COM 객체 관리 (메모리 누수 없음)
5. 포괄적인 오류 처리 및 사용자 피드백

이 프롬프트를 바탕으로 단계별로 개발을 진행하면서, 각 단계마다 테스트를 통해 안정성을 확보하고 점진적으로 기능을 확장해 나가세요.
